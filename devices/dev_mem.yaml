# @file dev_mem.yaml
#
# @brief DEV_MEM device
#
# @author Thomas Vanderbruggen <thomas@koheron.com>
# @date 08/03/2015
#
# (c) Koheron 2014-2015

name: DEV_MEM
description: Map and access physical memory

operations:
  - name: OPEN
    description: Do nothing, DevMem already opened by KServer
    flags:
      - name: AT_INIT

  - name: ADD_MEMORY_MAP
    description: Add memory map
    return: The ID of the memory map
    arguments:
      - name: device_addr
        type: unsigned int
        description: Physical address of the device
                                
      - name: map_size
        type: unsigned int
        description: Mmap size
                  
  - name: RM_MEMORY_MAP
    description: Remove a memory map
    arguments: 
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map
                        
  - name: READ
    description: Read a register
    return: The value of the register (integer)
    arguments: 
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register to read
             
  - name: WRITE
    description: Write a register
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register to read
                               
      - name: reg_val
        type: unsigned int
        description: Value to write in the register
                        
  - name: WRITE_BUFFER
    description: Write a buffer of registers
    flags:
      - name: SEND_BUFFER 
        buffer_name: 
          - data
        # Operations with flag SEND_BUFFER 
        # will automatically add an argument len_$buffer_name$
        # for each buffer. To be used in the handshaking protocol
              
    arguments:  
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register to write
                        
  - name: READ_BUFFER
    description: Read a buffer of registers
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map
                  
      - name: offset
        type: unsigned int
        description: Offset of the register to read
                
      - name: buff_size
        type: unsigned int
        description: Number of registers to read
                  
      - name: data_type
        type: string
        flag: CLIENT_ONLY # Only used by the client API
        default: uint32
        description: Type of received data

  - name: SET_BIT
    description: Set the value of a bit
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register

      - name: index
        type: unsigned int
        description: Index of the bit to set in the register

  - name: CLEAR_BIT
    description: Clear the value of a bit
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register

      - name: index
        type: unsigned int
        description: Index of the bit to set in the register

  - name: TOGGLE_BIT
    description: Toggle the value of a bit
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register

      - name: index
        type: unsigned int
        description: Index of the bit to set in the register
        
  - name: MASK_AND
    description: Apply a mask to a register with an AND
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register

      - name: mask
        type: unsigned int
        description: Mask to apply on the register
        
  - name: MASK_OR
    description: Apply a mask to a register with an OR
    arguments:
      - name: mmap_idx
        type: unsigned int
        cast: Klib::MemMapID
        description: Index of Memory Map

      - name: offset
        type: unsigned int
        description: Offset of the register

      - name: mask
        type: unsigned int
        description: Mask to apply on the register
           
# Middleware description
includes: # Must be in /middleware
  - drivers/core/wr_register.hpp
                       
objects: 
#  - name: dev_mem
#    type: Klib::DevMem
          
